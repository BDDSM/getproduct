# Get Product
Web-scraping сервис, который позволяет получать товар по штрихкоду с сайтов-провайдеров

## Сервис обладает следующим API:
|METHOD|PATH|DESCRIPTION|
| ------ | ------ | ------ |
|GET|/api/barcode/:barcode|Выдает быстрый результат (от самого быстрого провайдера), у остальных провайдеров запрос отменяется. При использовании этого метода ответ не кешируется|
|GET|/api/thebestproduct/:barcode|Сначала получает всевозможные варианты, затем вычисляет самый заполненный. Результат кешируется в локальном хранилище|
|DELETE|/api/localstorage/:barcode|Удаляет результат из локального хранилища|

Для выполнения запроса установлено ограничение - 10 секунд (по факту обработка укладывается в 1-2 секунды), запросы ко всем провайдерам происходят параллельно, если какой-либо сайт в это ограничение не уложился, то запрос отменяется и возвращается результат из имеющейся выборки.

## Модель товара
Если запрос выполнен успешно, то сервис возвращает JSON с HTTP кодом 200.
Поля в модели могут быть заполнены не все (в зависимости от предоставленной информации сайтом-провайдером).

|PROPERTY|TYPE|DESCRIPTION|
| ------ | ------ | ------ |
|barcode|string|Штрихкод|
|article|string|Артикул|
|name|string|Наименование|
|description|string|Описание товара|
|manufacturer|string|Производитель товара|
|unit|string|Единица измерения товара|
|weight|number|Вес 1 unit товара|
|picture|base64|Изображение товара|

## Сайты-провайдеры
Список сайтов-провайдеров постоянно изменяется. Приветствуются PULL request с Вашими провайдерами. Для добавления их в приложение достаточно реализовать интерфейс productProvider (см. каталог productProviders в репозитории).

Текущий список:
* barcode-list.ru
* biostyle.biz
* ru.disai.org
* национальный-каталог.рф
* vekaptek.ru

## Развертывание сервиса

Перед развертыванием необходимо изучить используемые переменные окружения (./scripts/example.env)

### Команда для запуска
```shell
docker run -d --name getproduct -p 11218:11218 --net getproduct-network --env-file ./scripts/example.env korableg/getproduct
```

Страница репозитория на Docker Hub: https://hub.docker.com/r/korableg/getproduct

### Также можно собрать образ самостоятельно
В каталоге scripts расположены shell скрипты для сборки и запуска docker контейнера с сервисом.
Рекомендуется запускать сервис вместе с контейнерами browserless/chrome и mongodb.

browserless/chrome - позволяет рендерить на клиенте html страницу (если она полностью написана на js), рекомендуется использовать, т.к. с ним результат запроса будет лучше
mongodb - позволяет закешировать ранее запрошенные данные